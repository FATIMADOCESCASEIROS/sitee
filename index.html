<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Jogos do Lucas — Sinuca 8 Ball Mania</title>
<style>
  body { margin: 0; background: #111; display: flex; justify-content: center; align-items: center; height: 100vh; }
  #gameCanvas { background: #2b2b2b; border: 4px solid #222; }
  #status { color: #fff; font-family: Arial, sans-serif; margin-top: 10px; text-align: center; }
</style>
</head>
<body>

<canvas id="gameCanvas" width="800" height="400"></canvas>
<div id="status">Sua vez! Clique e arraste para bater.</div>

<script>
// ====== Constantes ======
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const BALL_RADIUS = 10;
const FRICTION = 0.99;
const POCKET_RADIUS = 18;
const COLORS = ["#fff","#f00","#00f","#ff0","#0f0","#f0f","#0ff","#aaa","#333"];

// ====== Sons ======
const hitSound = new Audio("https://cdn.pixabay.com/download/audio/2021/08/04/audio_88173eb644.mp3?filename=hit-124614.mp3");
const pocketSound = new Audio("https://cdn.pixabay.com/download/audio/2022/03/19/audio_ea0f6531d1.mp3?filename=coin-drop-7401.mp3");

// ====== Bolas ======
let balls = [];
let cueBall;
let currentPlayer = "Jogador";

// ====== Setup Inicial ======
function initBalls() {
  balls = [];
  // Bola branca
  cueBall = { x: 150, y: canvas.height/2, vx:0, vy:0, color: COLORS[0], pocketed: false };

  // Bolas restantes em triângulo
  let startX = 550, startY = canvas.height/2;
  let count = 1;
  for (let row=0; row<5; row++) {
    for (let j=0; j<=row; j++) {
      balls.push({ x: startX + row*22, y: startY + (j-row/2)*22, vx:0, vy:0, color: COLORS[count%COLORS.length], pocketed:false });
      count++;
    }
  }
}
initBalls();

// ====== Física ======
function moveBalls() {
  for (let b of [cueBall, ...balls]) {
    if (b.pocketed) continue;
    b.x += b.vx;
    b.y += b.vy;
    b.vx *= FRICTION;
    b.vy *= FRICTION;

    // Colisão com bordas
    if (b.x < BALL_RADIUS || b.x > canvas.width - BALL_RADIUS) b.vx *= -1;
    if (b.y < BALL_RADIUS || b.y > canvas.height - BALL_RADIUS) b.vy *= -1;

    // Bolas nos buracos?
    if (isPocketed(b)) {
      b.pocketed = true;
      pocketSound.play();
    }
  }
}

function isPocketed(b) {
  let pockets = [
    {x:0,y:0}, {x: canvas.width/2, y:0}, {x:canvas.width,y:0},
    {x:0,y:canvas.height}, {x:canvas.width/2,y:canvas.height}, {x:canvas.width,y:canvas.height}
  ];
  for (let p of pockets) {
    if (Math.hypot(b.x-p.x, b.y-p.y) < POCKET_RADIUS) return true;
  }
  return false;
}

// ====== Desenho ======
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Mesa
  ctx.fillStyle = "#3a5";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Bolas
  for (let b of [cueBall, ...balls]) {
    if (!b.pocketed) {
      ctx.beginPath();
      ctx.arc(b.x, b.y, BALL_RADIUS, 0, Math.PI*2);
      ctx.fillStyle = b.color;
      ctx.fill();
      ctx.strokeStyle = "#000";
      ctx.stroke();
    }
  }
}

// ====== Mira e Tacada ======
let aiming = false, startX, startY;

canvas.addEventListener("mousedown", function(e) {
  if (currentPlayer==="Jogador" && isStopped()) {
    aiming = true;
    startX = e.offsetX;
    startY = e.offsetY;
  }
});

canvas.addEventListener("mouseup", function(e) {
  if (aiming) {
    aiming = false;
    let dx = startX - e.offsetX;
    let dy = startY - e.offsetY;
    cueBall.vx = dx/5;
    cueBall.vy = dy/5;
    hitSound.play();
    currentPlayer = "CPU";
    document.getElementById("status").innerText = "CPU jogando...";
    setTimeout(cpuPlay, 1500);
  }
});

// ====== Verifica se todas as bolas pararam ======
function isStopped() {
  return Math.hypot(cueBall.vx, cueBall.vy) < 0.1 && balls.every(b=> Math.hypot(b.vx,b.vy) < 0.1);
}

// ====== IA Simples ======
function cpuPlay() {
  if (!isStopped()) { setTimeout(cpuPlay, 1000); return; }

  // Mira aleatória
  let angle = Math.random()*Math.PI*2;
  let force = 5 + Math.random()*5;
  cueBall.vx = Math.cos(angle)*force;
  cueBall.vy = Math.sin(angle)*force;
  hitSound.play();

  currentPlayer = "Jogador";
  document.getElementById("status").innerText = "Sua vez! Clique e arraste.";
}

// ====== Loop Principal ======
function loop() {
  moveBalls();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
